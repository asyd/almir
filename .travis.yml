language: python
python:
  - 2.6
  - 2.7
install:
  - sudo apt-get install -y libevent-dev git gcc python-dev sendmail bacula-console
  - cp buildout.d/templates/buildout.cfg.in buildout.cfg
  - sudo cat /etc/bacula/bconsole.conf
  - sed -i 's/bacula.db/bacula_kaki.db/' buildout.cfg
  - director_password=$(sudo grep 'Password' /etc/bacula/bconsole.conf | sed 's/.*Password\s*=\s*"\(.\+\)"/\1/')
  - sed -i "s@director_password = @director_password = $director_password@" buildout.cfg
  - cat buildout.cfg
  - python bootstrap.py
  - bin/buildout

ibefore_script:
  - "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start"
  - "python -m SimpleHTTPServer >/dev/null 2>/dev/null&"
script:
  - bin/nosetests
  - find almir/tests/javascript/ -iname "test_*" | xargs phantomjs almir/tests/javascript/run-qunit.js

notifications:
  irc:
    - "irc.freenode.org#almir"
