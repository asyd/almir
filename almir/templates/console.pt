<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="load: base.pt">
    <tal:block metal:fill-slot="main-content-title">
      <h1 class="view">Console <small>Interactive candies</small></h1>
      <script type="text/javascript">
          var bconsole_url = '${ request.route_url('console_ajax') }';
      </script>
    </tal:block>
    <tal:block metal:fill-slot="main-content">
      <div tal:condition="permission_problem" class="alert-message block-message warning">
        <p>sudo bconsole must be executable</p>
        <div class="alert alert-actions">
           <a class="btn small" href="">I fixed the problem, retry</a>
        </div>
      </div>
      <tal:block tal:condition="not permission_problem">
        <div id="console" class="alert alert-info block-message">
        </div>
        <div class="row-fluid">
          <div class="span11">
              <input id="command" value="" class="span12"
                  data-provide="typeahead"
                  data-source='[${ command_array }]'
                  />
          </div>
          <div class="span1">
              <button id="command-btn" class="btn btn-primary">Send</button>
          </div>
        </div>
      </tal:block>
    </tal:block>

    <tal:block metal:fill-slot="main-sidebar-title">
      <h1 class="view">Commands</h1>
    </tal:block>
    <tal:block metal:fill-slot="main-sidebar">
    <!-- TODO: search through commands -->
    <!-- TODO: full description on hover -->
    <table id="command_help" class="table table-striped table-bordered table-condensed word-wrapped">
     <thead>
        <tr>
          <th>command</th>
          <th>description</th>
        </tr>
     </thead>
     <tbody tal:define="escapee import: cgi.escape">
         <!-- escape help of commands because .html() with unescape html entities so we have to double escape our help text. -->
         <tr tal:repeat="data console_commands.items()" data-original-title="Parameters" data-content="${ escapee(data[1].help) }">
            <td>${ data[0] }</td> <td>${ data[1].desc }</td>
        </tr>
      </tbody>
    </table>
    </tal:block>
</html>
